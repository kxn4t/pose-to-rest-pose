# Pose to Rest Pose

シェイプキーとドライバーを保持したまま、現在のポーズをレストポーズとしてワンクリックで適用するBlenderアドオン。

## 機能

- **ワンクリック操作**: ポーズメニューから直接、現在のポーズをレストポーズとして適用
- **シェイプキー保持**: 値、スライダー範囲、ミュート状態、カスタムプロパティを含むすべてのシェイプキーを維持
- **ドライバーサポート**: シェイプキーのドライバーを保持し、自己参照を自動更新
- **複数メッシュ対応**: 同じアーマチュアの影響を受ける複数のメッシュを処理

## インストール方法

1. Blenderを開き、「編集」→「プリファレンス」→「アドオン」を開きます
2. 「ディスクからインストール...」をクリックします
3. ダウンロードした`pose-to-rest-pose.zip`を選択します
4. アドオン一覧で「Pose to Rest Pose」の横のチェックボックスをオンにしてアドオンを有効化

## 使用方法

### 基本的な使用方法
1. アーマチュアを選択して**ポーズモード**に入る
2. アーマチュアを希望のポーズに配置
3. **Pose > Apply > Apply Current Pose as Rest Pose**を選択

アドオンは自動的に以下を実行します:
- 選択したアーマチュアをターゲットとするアーマチュアモディファイアを持つすべてのメッシュを検出
- すべてのシェイプキーとそのプロパティを保持
- 現在のポーズをアーマチュアのレストポジションに適用
- すべてのモディファイアとドライバーを復元

## 技術的詳細

### シェイプキー処理
このアドオンは[SKkeeper](https://github.com/smokejohn/SKkeeper)のアルゴリズムを使用して以下を実行します:
- 各シェイプキーの一時的なコピーを作成
- 現在のポーズでアーマチュアモディファイアを適用
- シェイプキーをベースメッシュに転送
- すべてのシェイプキーのプロパティと関係を維持

### ドライバー処理
- シェイプキーの既存のドライバーを自動検出
- ドライバーの式と変数を保持
- オブジェクトが置き換えられた際の自己参照を更新
- すべてのドライバー関係を復元

## 要件

- Blender 3.6以上
- メッシュは対象アーマチュアごとに1つのアーマチュアモディファイアのみ持つこと

## 制限事項とベストプラクティス

### モディファイアの順序
最適な結果を得るには、適切なモディファイア順序を確保する必要があります:
- ✅ **推奨**: アーマチュアモディファイア → その他の変形モディファイア
- ❌ **非推奨**: 変形モディファイア → アーマチュアモディファイア

アーマチュアモディファイアの前に配置された変形モディファイア（ディスプレイス、波、シュリンクラップなど）は、シェイプキー転送時に頂点数の不一致を引き起こす可能性があります。
また、頂点数を変更する可能性があるモディファイアに関しても同様です。

## ライセンス

GPL v3 License (LICENSE参照) 個人・商用問わず自由に利用できます。

## クレジット

このアドオンは、SKkeeperのシェイプキー保持アルゴリズムを参考にして作成されています。

- **シェイプキーアルゴリズム**: [SKkeeper](https://github.com/smokejohn/SKkeeper) by Johannes Rauch
- **ライセンス**: GPL v3
